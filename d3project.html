<!DOCTYPE html>
<meta charset="utf-8">
<title>Jake Martin D3</title>
<style>

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: auto;
  position: relative;
  width: 960px;
}

</style>
<body>
  <h1> Jake Martin Project</h1>
  <script src="d3.min.js" charset="utf-8"></script>
  <div id="chopstick_chart" />

<script>
//Width and height
  var w = 500;
  var h = 100;
  var barPadding = 1;

  var stickIndex = 0
  var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
          11, 12, 15, 20, 18, 17, 16, 18, 23, 25, 5, 10, 13, 19, 21, 25, 22, 18, 15, 13, 15 ];


  var temp = [];
  d3.csv("chopstick-reformatted2.csv", function(error, data) {
    var i = 0;
    var a = [];
    data.forEach(function(d) {
      d.efficiency = +d.efficiency;
      d.chopLength = +d.chopLength;
      d.individual = +d.individual;
      a.push(d);
      i++;
      if ((i % 31) == 0){
        temp.push(a);
        a = [];
      }
    });
    init();
  });

  function init() {
            //Create SVG element
  	var svg = d3.select("body")
  				.append("svg")
  				.attr("width", w)
  				.attr("height", h);

  	svg.selectAll("rect")
        .data(temp[stickIndex])
  	   .enter()
  	   .append("rect")
  	   .attr("x", function(d, i) {
  	   		return i * (w / dataset.length);
  	   })
  	   .attr("y", function(d) {
          console.log(d)
  	   		return h - (d.efficiency * 4);
  	   })
  	   .attr("width", w / dataset.length - barPadding)
  	   .attr("height", function(d) {
  	   		return d.efficiency * 4;
  	   })
  	   .attr("fill", function(d) {
  			return "hsl(319, 69%, " + (d.efficiency * 2.2) + "%)";
  	   });

  	svg.selectAll("text")
        .data(temp[stickIndex])
  	   .enter()
  	   .append("text")
  	   .text(function(d) {
  	   		return d.individual;
  	   })
  	   .attr("text-anchor", "middle")
  	   .attr("x", function(d, i) {
  	   		return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
  	   })
  	   .attr("y", function(d) {
  	   		return h - (d.individual * 4) + 14;
  	   })
  	   .attr("font-family", "sans-serif")
  	   .attr("font-size", "11px")
  	   .attr("fill", "white");

       // Allow the arrow keys to change the displayed chopLength.
       window.focus();
       d3.select(window).on("keydown", function() {
         switch (d3.event.keyCode) {
           case 37: stickIndex--; break;
           case 39: stickIndex++; break;
         }
         if (stickIndex < 0){
           stickIndex = 0;
         }
         if (stickIndex > 5){
           stickIndex = 5;
         }
         redraw(svg);
       });

     };
     function redraw(svg) {
       svg.selectAll("rect")
       .data(temp[stickIndex])
     	   .attr("x", function(d, i) {
     	   		return i * (w / dataset.length);
     	   })
     	   .attr("y", function(d) {
     	   		return h - (d.efficiency * 4);
     	   })
     	   .attr("width", w / dataset.length - barPadding)
     	   .attr("height", function(d) {
     	   		return d.efficiency * 4;
     	   })
     	   .attr("fill", function(d) {
            return "hsl(319, 69%, " + (d.efficiency * 2.2) + "%)";
     	   });

     	svg.selectAll("text")
       .data(temp[stickIndex])
     	   .text(function(d) {
     	   		return d.individual;
     	   })
     	   .attr("text-anchor", "middle")
     	   .attr("x", function(d, i) {
     	   		return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
     	   })
     	   .attr("y", function(d) {
     	   		return h - (d.individual * 4) + 14;
     	   })
     	   .attr("font-family", "sans-serif")
     	   .attr("font-size", "11px")
     	   .attr("fill", "white");
   };

   var dataset = [ 13, 3, 13, 19, 21, 25, 22, 18, 15, 13,
           11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
  </script>
</body>

</html>
